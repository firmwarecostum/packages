From 116fa1c1a78ef8096d6d6fca00fda4bbbe5d08f8 Mon Sep 17 00:00:00 2001
From: Tuomo Soini <tis@foobar.fi>
Date: Tue, 24 Oct 2017 10:50:02 +0300
Subject: [PATCH] pluto: Fix DEFAULT_RUNDIR to be set so that our rundir is
 really configurable

Add pieces missed from
15de38097fbaf775c8823a99843c4139d7bd2

Signed-off-by: Tuomo Soini <tis@foobar.fi>
---
 mk/userland-cflags.mk   | 1 +
 programs/setup/setup.in | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/mk/userland-cflags.mk b/mk/userland-cflags.mk
index d26c2d703..1743a166a 100644
--- a/mk/userland-cflags.mk
+++ b/mk/userland-cflags.mk
@@ -140,6 +140,7 @@ ifeq ($(USE_SINGLE_CONF_DIR),true)
 USERLAND_CFLAGS+=-DSINGLE_CONF_DIR=1
 endif
 
+USERLAND_CFLAGS+=-DDEFAULT_RUNDIR=\"$(FINALRUNDIR)\"
 USERLAND_CFLAGS+=-DFIPSPRODUCTCHECK=\"${FIPSPRODUCTCHECK}\"
 USERLAND_CFLAGS+=-DIPSEC_CONF=\"$(FINALCONFFILE)\"
 USERLAND_CFLAGS+=-DIPSEC_CONFDDIR=\"$(FINALCONFDDIR)\"
diff --git a/programs/setup/setup.in b/programs/setup/setup.in
index 345d0c11b..934077ce4 100755
--- a/programs/setup/setup.in
+++ b/programs/setup/setup.in
@@ -18,7 +18,7 @@
 # This is the version for use on Linux.
 
 # Misc. paths (some of this should perhaps be overrideable from ipsec.conf).
-rundir=@FINALRUNDIR@
+rundir=@IPSEC_RUNDIR@
 
 #pluto searches the current directory, so this is required for making it selinux compliant
 cd /
-- 
2.14.1

